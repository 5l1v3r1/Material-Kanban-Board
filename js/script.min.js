var materialKanban=function(){"use strict";var e={version:"1.0.2b",escapeHTML:function(e){if(null===e)return null;if(void 0!==e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){}try{return apex.util.escapeHTML(String(e))}catch(a){return(e=String(e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}},loader:{start:function(e){try{apex.util.showSpinner($(e))}catch(t){var a=$("<span></span>");a.attr("id","loader"+e),a.addClass("ct-loader fa-stack fa-3x");var r=$("<i></i>");r.addClass("fa fa-circle fa-stack-2x"),r.css("color","rgba(121,121,121,0.6)");var n=$("<i></i>");n.addClass("fa fa-refresh fa-spin fa-inverse fa-stack-1x"),n.css("animation-duration","1.8s"),a.append(r),a.append(n),$(e).append(a)}},stop:function(e){$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},jsonSaveExtend:function(e,a,r){void 0==r&&(r=!0);var n={};if("string"==typeof a)try{a=JSON.parse(a)}catch(e){console.error("Error while try to parse udConfigJSON. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(a)}else n=a;try{n=$.extend(r,[],e,a)}catch(a){console.error("Error while try to merge udConfigJSON into Standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(a),n=e,console.error(n)}return n},noDataMessage:{show:function(e,a){var r=$("<div></div>").css("margin","12px").css("text-align","center").css("padding","64px 0").addClass("nodatafoundmessage"),n=$("<div></div>"),t=$("<span></span>").addClass("fa").addClass("fa-search").addClass("fa-2x").css("height","32px").css("width","32px").css("color","#D0D0D0").css("margin-bottom","16px");n.append(t);var o=$("<span></span>").text(a).css("display","block").css("color","#707070").css("font-size","12px");r.append(n).append(o),$(e).append(r)},hide:function(e){$(e).children(".nodatafoundmessage").remove()}},groupBy:function(e,a){var r=new Map;return e.forEach(function(e){var n=a(e);r.has(n)?r.get(n).push(e):r.set(n,[e])}),r}};return{initialize:function(a,r,n,t,o,s,d,i){function c(){if(r)e.loader.start(f),apex.server.plugin(r,{pageItems:o,x01:"getData"},{success:function(e){v.trigger("materialkanbandataloaded"),O(e),v.trigger("materialkanbandatarendered")},error:function(e){f.empty(),console.log(e.responseText)},dataType:"json"});else try{e.loader.start(f),setTimeout(function(){O(dataJSON)},500)}catch(e){console.log("need data json"),console.log(e)}}function O(a){if(L.printDataToConsole&&(console.log(JSON.stringify(a)),console.log(a)),I=a.row,f.empty(),L.dynamicColumns){var t=[];e.groupBy(a.row,function(e){return e.COLUMN_ID}).forEach(function(e,a,r){a&&t.push(e[0])}),u=t}if($.each(u,function(a,r){!1!==d&&(r.COLUMN_ID=e.escapeHTML(r.COLUMN_ID),r.COLUMN_TITLE=e.escapeHTML(r.COLUMN_TITLE),r.COLUMN_ICON=e.escapeHTML(r.COLUMN_ICON),r.COLUMN_ICON_COLOR=e.escapeHTML(r.COLUMN_ICON_COLOR),r.COLUMN_HEADER_STYLE=e.escapeHTML(r.COLUMN_HEADER_STYLE),r.COLUMN_COLOR=e.escapeHTML(r.COLUMN_COLOR)),void 0==r.COLUMN_COLOR&&(r.COLUMN_COLOR="hsl("+46*a%350+", 55%, 60%)"),r.COLUMN_INDEX=r.COLUMN_INDEX?r.COLUMN_INDEX:a}),u&&u.length>0){_=L.groupExtension?100/(12*u.length/L.groupColWidth+1):0,g=(100-_)/u.length,function(e){var a=l(e);if(a.addClass("kb-row"),L.groupExtension){var r=$("<div></div>");r.addClass("kb-col kb-col-header"),r.attr("style","width:"+_+"%"),a.append(r)}$.each(u,function(e,n){(r=$("<div></div>")).addClass("kb-col kb-col-header"),r.attr("style","width:"+g+"%"),r.attr("id",n.COLUMN_ID);var t=$("<div></div>");t.addClass("kb-col-header-content");var o="border-top-color: "+n.COLUMN_COLOR+";";t.attr("style",n.COLUMN_HEADER_STYLE||o);var s=void 0!=n.COLUMN_TITLE?n.COLUMN_TITLE:"";t.append('<p class="title">'+s+"</p>"),r.append(t),a.append(r)})}(f);var s=l(f);if(a.row&&a.row.length>0){e.groupBy(a.row,function(e){return L.groupExtension?e.GROUP_ID:1}).forEach(function(a,r,n){if(r){var t=l(s);t.addClass("kb-row"),t.attr("groupid",r),L.groupExtension&&function(a,r){!1!==d&&(r.GROUP_ID=e.escapeHTML(r.GROUP_ID),r.GROUP_ICON=e.escapeHTML(r.GROUP_ICON),r.GROUP_ICON_COLOR=e.escapeHTML(r.GROUP_ICON_COLOR),r.GROUP_HEADER_STYLE=e.escapeHTML(r.GROUP_HEADER_STYLE),r.GROUP_TITLE=e.escapeHTML(r.GROUP_TITLE),r.GROUP_FOOTER=e.escapeHTML(r.GROUP_FOOTER));var n=$("<div></div>");n.addClass("kb-col kb-group-region"),n.attr("style","width:"+_+"%"),a.append(n),C(n,{isGroupCard:!0,ID:r.GROUP_ID,ICON:r.GROUP_ICON,ICON_COLOR:r.GROUP_ICON_COLOR,HEADER_STYLE:r.GROUP_HEADER_STYLE,TITLE:r.GROUP_TITLE,FOOTER:r.GROUP_FOOTER,LINK:r.GROUP_LINK})}(t,a[0]),$.each(u,function(r,n){!function(a,r,n){var t=$("<div></div>");t.addClass("kb-col kb-item-region"),t.attr("style","width:"+g+"%"),a.append(t);var o=$("<div></div>");o.addClass("kb-col-content");var s="border-left-color: "+n.COLUMN_COLOR+";";o.attr("style",n.COLUMN_HEADER_STYLE||s),t.append(o);var i=$("<div></div>");i.addClass("kb-col-inner-header");var c=void 0!=n.COLUMN_TITLE?n.COLUMN_TITLE:"";i.append('<p class="title">'+c+"</p>"),o.append(i);var O=$("<div></div>");if(O.addClass("kb-item-container"),O.attr("columnid",n.COLUMN_ID),o.append(O),0==n.COLUMN_INDEX){var l=r.filter(function(e){return e.GROUP_NEW_ITEM_LINK});l.length>0&&(O.addClass("kb-item-container-with-new-card"),function(e,a){var r=$("<div></div>");r.addClass("kb-new-card");var n=$("<i></i>");n.addClass("fa fa-plus"),r.append(n);var t=$("<a></a>");t.attr("href",a),t.append(r);var o=$("<div></div>");o.addClass("kb-new-item-region"),o.append(t),e.append(o)}(o,l[0].GROUP_NEW_ITEM_LINK))}!function(a,r,n){a&&a.length>0&&$.each(a,function(a,t){!1!==d&&(t.ID=e.escapeHTML(t.ID),t.ICON=e.escapeHTML(t.ICON),t.ICON_COLOR=e.escapeHTML(t.ICON_COLOR),t.HEADER_STYLE=e.escapeHTML(t.HEADER_STYLE),t.TITLE=e.escapeHTML(t.TITLE),t.FOOTER=e.escapeHTML(t.FOOTER)),C(r,{isGroupCard:!1,ID:t.ID,ICON:t.ICON,ICON_COLOR:t.ICON_COLOR,HEADER_STYLE:t.HEADER_STYLE,TITLE:t.TITLE,FOOTER:t.FOOTER,LINK:t.LINK},n)})}(r.filter(function(e){return e.COLUMN_ID==n.COLUMN_ID&&e.ID}),O,n)}(t,a,n)})}}),i&&function(){var e=0,a=null;N=dragula($(".kb-item-container").toArray(),{direction:"vertical",accepts:function(e,a,r,n){return!!L.allowDragItemsBetweenGroups||$(r).closest(".kb-row").attr("groupid")==$(a).closest(".kb-row").attr("groupid")}}),$(".kb-card").each(function(e,a){a.addEventListener("touchmove",function(e){e.preventDefault()})}),N.on("drag",function(r,n){var t=$(r),o=$(n);e=t.index();var s=t.next();a=s.length>0?$(s[0]):null;var d={itemId:t.attr("itemid"),sourceGroupId:o.closest(".kb-row").attr("groupid"),sourceColumnId:o.attr("columnid"),sourceItemIndex:e};v.trigger("materialkanbandrag",[d])}),N.on("drop",function(n,t,s,d){var i=$(n),c=$(t),O=$(s),l={itemId:i.attr("itemid"),sourceGroupId:O.closest(".kb-row").attr("groupid"),sourceColumnId:O.attr("columnid"),sourceItemIndex:e,targetGroupId:c.closest(".kb-row").attr("groupid"),targetColumnId:c.attr("columnid"),targetItemIndex:i.index()};try{apex.server.plugin(r,{pageItems:o,x01:"moveItem",x02:l.itemId,x03:l.sourceGroupId,x04:l.sourceColumnId,x05:l.sourceItemIndex,x06:l.targetGroupId,x07:l.targetColumnId,x08:l.targetItemIndex},{success:function(e){},error:function(e){a?i.insertBefore(a):O.append(i),p(i,O.attr("columnid")),console.error(e.responseText),v.trigger("materialkanbandroperror",[l])},dataType:"json"})}catch(e){console.log("Can't call server on drag'n drop event. Apex is missing"),console.log(e)}p(i,c.attr("columnid")),v.trigger("materialkanbandrop",[l])})}()}else s.css("min-height",""),e.noDataMessage.show(s,n)}else console.log("No columns defined!")}function l(e){var a=$("<div></div>");return a.addClass("s-g-row"),e.append(a),a}function C(e,a,r){var n=$("<div></div>");n.addClass("kb-card"),n.attr("itemid",a.ID);var t=$("<div></div>");if(t.addClass("card-header"),a.ICON||r&&r.COLUMN_ICON){var o=$("<i></i>");o.addClass("fa "+(a.ICON||r.COLUMN_ICON)),(a.ICON_COLOR&&a.ICON_COLOR.length>0||r&&r.COLUMN_ICON_COLOR&&r.COLUMN_ICON_COLOR.length>0)&&o.attr("style","color:"+(a.ICON_COLOR||r.COLUMN_ICON_COLOR)),t.append(o)}a.HEADER_STYLE?t.attr("style",a.HEADER_STYLE):r&&r.COLUMN_COLOR&&t.attr("style","background:"+r.COLUMN_COLOR),n.append(t);var s=$("<div></div>");s.addClass("card-content");var d=a.TITLE?a.TITLE:"";if(s.append('<p class="title">'+d+"</p>"),a.LINK){var i=$("<a></a>");i.attr("href",a.LINK),i.append(s),n.append(i)}else n.append(s);if(a.FOOTER){var c=$("<div></div>");c.addClass("card-footer");var O=$("<div></div>");O.append(a.FOOTER),c.append(O),n.append(c)}e.append(n)}function p(e,a){var r=e.attr("itemid"),n=I.find(function(e){return e.ID==r}),t=u.find(function(e){return e.COLUMN_ID==a}),o=e.find(".card-header"),s=o.find("i");(n&&n.ICON||t&&t.COLUMN_ICON)&&(s.removeClass().addClass("fa "+(n.ICON||t.COLUMN_ICON)),(n.ICON_COLOR&&n.ICON_COLOR.length>0||t&&t.COLUMN_ICON_COLOR&&t.COLUMN_ICON_COLOR.length>0)&&s.attr("style","color:"+(n.ICON_COLOR||t.COLUMN_ICON_COLOR))),!n.HEADER_STYLE&&t&&t.COLUMN_COLOR&&o.attr("style","background:"+t.COLUMN_COLOR)}var L={},u=(L=e.jsonSaveExtend({refresh:0,staticColumns:[{COLUMN_ID:"1",COLUMN_TITLE:"To Do",COLUMN_ICON:"fa-calendar"},{COLUMN_ID:"2",COLUMN_TITLE:"In Progress",COLUMN_ICON:"fa-wrench"},{COLUMN_ID:"3",COLUMN_TITLE:"Done",COLUMN_ICON:"fa-check"}],dynamicColumns:!1,groupExtension:!1,groupColWidth:6,allowDragItemsBetweenGroups:!1,printDataToConsole:!1},t,!1)).staticColumns,I=null,N=null,f=null,_=0,g=100,v=$("#"+a);if(v.length>0){f=function(e){var a=$("<div></div>");return a.addClass("s-g-container"),a.css("min-height","170px"),e.append(a),a}(v),c();try{apex.jQuery("#"+s).bind("apexrefresh",function(){0==f.children("span").length&&(N&&N.destroy(),c())})}catch(e){console.log("Can't bind refresh event on "+s+". Apex is missing"),console.log(e)}L.refresh>0&&setInterval(function(){0==f.children("span").length&&(N&&N.destroy(),c())},1e3*L.refresh)}else console.log("Can't find parentID: "+a)}}}();